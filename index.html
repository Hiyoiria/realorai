<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>r/RealOrAI - Visual Data Analysis</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>

    <!-- ECharts WordCloud Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>

    <!-- Data Configuration -->
    <script src="visualization_data_config.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#F6F6F2',
                        panel: '#FFFFFF',
                        primary: '#567C4D',
                        ai: '#D9534F',
                        human: '#5BC0DE',
                        unsure: '#F0AD4E',
                        text: '#333333',
                        border: '#E0E0E0'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F6F6F2; color: #333; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* Enhanced Table Styles */
        .stats-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .stats-table th {
            background: linear-gradient(to bottom, #f9fafb, #f3f4f6);
            padding: 14px 16px;
            text-align: left;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #4b5563;
            border-bottom: 2px solid #567C4D;
            position: sticky;
            top: 0;
        }
        .stats-table th:first-child {
            border-top-left-radius: 8px;
        }
        .stats-table th:last-child {
            border-top-right-radius: 8px;
        }
        .stats-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
            color: #374151;
        }
        .stats-table tbody tr {
            transition: all 0.2s ease;
        }
        .stats-table tbody tr:hover {
            background: #f0fdf4;
            transform: translateX(2px);
        }
        .stats-table tbody tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }
        .stats-table tbody tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }

        /* Annotation Styles */
        .annotation-box {
            position: absolute;
            border: 2px solid;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }
        .annotation-box.active { opacity: 1; transform: scale(1); }

        .comment-item {
            transition: all 0.3s;
            opacity: 0.5;
            transform: translateX(-10px);
        }
        .comment-item.active {
            opacity: 1;
            transform: translateX(0);
            background: #FFF;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Strategy Card Styles */
        .strategy-card {
            transition: all 0.3s;
            cursor: pointer;
        }
        .strategy-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }


        /* GAME STYLES */
        .target-image { transition: filter 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .blur-state { filter: blur(12px) brightness(0.9); }
        .donut-wrapper {
            opacity: 0; transform: scale(0.9);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .show-overlay .donut-wrapper { opacity: 1; transform: scale(1); }
        .panel-fade-in { animation: fadeInPanel 0.4s ease-out forwards; }
        @keyframes fadeInPanel {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- HEADER -->
    <header class="h-16 bg-bg border-b-2 border-[#E6E6E1] flex items-center justify-between px-6 shrink-0 z-50">
        <div class="flex items-center gap-3">
            <span class="bg-primary text-white text-[10px] font-bold px-2 py-1 tracking-wider uppercase rounded-sm">SYS_ONLINE</span>
            <div class="flex flex-col leading-none">
                <span class="text-xl font-extrabold tracking-tight text-text">r/RealOrAI</span>
                <span class="text-[10px] text-secondary uppercase tracking-widest mt-0.5">Visual Data Analysis System</span>
            </div>
        </div>
        <nav class="flex gap-2">
            <button onclick="switchView('analysis')" id="btn-nav-analysis" class="px-4 py-1.5 text-xs font-semibold text-white bg-primary rounded shadow-sm transition-colors">ANALYSIS</button>
            <button onclick="switchView('game')" id="btn-nav-game" class="px-4 py-1.5 text-xs font-semibold text-secondary hover:text-primary transition-colors hover:bg-white rounded">GAME</button>
        </nav>
    </header>

    <!-- MAIN CONTAINER -->
    <main class="flex-1 relative overflow-hidden">

        <!-- ===== VIEW 1: ANALYSIS DASHBOARD ===== -->
        <div id="view-analysis" class="absolute inset-0 overflow-y-auto scroll-smooth">
            <div class="max-w-7xl mx-auto p-8 space-y-16 pb-32">

                <!-- ===== SECTION 1: OVERALL VIEW ===== -->
                <section id="overall">
                    <div class="border-l-4 border-primary pl-4 mb-8">
                        <h1 class="text-2xl font-bold text-gray-800">Overall View - Global Statistics</h1>
                        <p class="text-sm text-gray-500 mt-1">Data Source: All 920 Posts | Time Period: Oct 2024 - Jan 2025</p>
                    </div>

                    <!-- 1.0 DESCRIPTIVE STATISTICS TABLES -->
                    <div class="mb-12">
                        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Descriptive Statistics Summary</h2>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- Basic Stats Table -->
                            <div class="bg-white rounded-lg border border-border shadow-sm overflow-hidden">
                                <div class="bg-gradient-to-r from-primary/10 to-primary/5 px-5 py-3 border-b-2 border-primary/20">
                                    <h3 class="text-xs font-bold text-gray-700 uppercase tracking-wide">üìä Basic Statistics</h3>
                                </div>
                                <table class="stats-table">
                                    <thead>
                                        <tr>
                                            <th>Metric</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody id="basic-stats-tbody"></tbody>
                                </table>
                            </div>

                            <!-- Verdict Distribution Table -->
                            <div class="bg-white rounded-lg border border-border shadow-sm overflow-hidden">
                                <div class="bg-gradient-to-r from-primary/10 to-primary/5 px-5 py-3 border-b-2 border-primary/20">
                                    <h3 class="text-xs font-bold text-gray-700 uppercase tracking-wide">ü§ñ Bot Verdict Distribution</h3>
                                </div>
                                <table class="stats-table">
                                    <thead>
                                        <tr>
                                            <th>Verdict</th>
                                            <th>Count</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="verdict-stats-tbody"></tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!-- 1.1 Post Simulation -->
                    <div class="mb-12">
                        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">How Users Argue - Discourse Simulation</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-0 border border-border rounded-lg overflow-hidden bg-white shadow-sm h-[450px]">
                            <!-- Left: Image Canvas -->
                            <div class="relative bg-gray-100 flex items-center justify-center overflow-hidden group">
                                <img id="sim-image" src="" class="w-full h-full object-cover opacity-90">

                                <!-- Dynamic Annotations -->
                                <div id="sim-annotations"></div>

                                <div class="absolute bottom-4 left-4 bg-black/60 text-white text-xs px-3 py-1 rounded-full backdrop-blur-sm">
                                    Simulated Reddit Post View
                                </div>
                            </div>

                            <!-- Right: Comment Stream -->
                            <div class="bg-gray-50 p-6 flex flex-col border-l border-border relative">
                                <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-200">
                                    <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold">r/</div>
                                    <div>
                                        <div class="font-bold text-sm" id="sim-title"></div>
                                        <div class="text-[10px] text-gray-400">u/user123 ‚Ä¢ 5 hours ago</div>
                                    </div>
                                </div>

                                <div class="flex-1 overflow-y-auto space-y-4 no-scrollbar pr-2" id="comment-stream"></div>
                            </div>
                        </div>
                    </div>


                    <!-- Summary -->
                    <div class="bg-primary/5 border border-primary/20 p-4 rounded-lg text-sm text-gray-700 leading-relaxed">
                        <strong>Summary:</strong> <span id="overall-summary"></span>
                    </div>
                </section>

                <!-- DIVIDER -->
                <div class="border-t-2 border-dashed border-gray-300"></div>

                <!-- ===== SECTION 2: DETAILED ANALYSIS ===== -->
                <section id="detailed">
                    <div class="border-l-4 border-human pl-4 mb-8">
                        <h1 class="text-2xl font-bold text-gray-800">Detailed Rationale Analysis</h1>
                        <p class="text-sm text-gray-500 mt-1">Data Source: 130 Valid Posts with Image Analysis | Total Rationales: 5,739 | Total Comments: 3,471</p>
                    </div>

                    <!-- 2.1.1 Hot Entities Word Cloud (Standalone) -->
                    <div class="mb-16">
                        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Hot Entities Distribution</h2>
                        <div class="bg-white border border-border rounded-lg shadow-sm p-6 relative" style="height: 400px;">
                            <h3 class="absolute top-3 left-4 text-xs font-bold text-gray-400 z-10 uppercase">Most Discussed Visual Elements</h3>
                            <div id="chart-wordcloud" style="width: 100%; height: 100%;"></div>
                        </div>
                    </div>

                    <!-- 2.1.2 Gallery -->
                    <div class="mb-16">
                        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Example Images Under Discussion</h2>
                        <div class="flex gap-4 overflow-x-auto pb-2 no-scrollbar snap-x" id="gallery-container"></div>
                    </div>

                    <!-- 2.2 Argumentation Methods -->
                    <div class="mb-16">
                        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-6">Argumentation Strategies Analysis</h2>

                        <!-- 2.2.0 Strategy Explanations (All 7) -->
                        <div class="mb-10">
                            <h3 class="text-xs font-bold text-gray-500 uppercase mb-4">Seven Argumentation Categories</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="strategy-cards"></div>
                        </div>

                        <!-- 2.2.1 Radar Chart -->
                        <div class="mb-12">
                            <div class="glass-panel p-6 rounded-lg relative">
                                <h3 class="absolute top-4 left-6 text-xs font-bold text-gray-500 uppercase">Strategy Distribution Comparison (AI vs Real)</h3>
                                <div id="chart-radar" style="width: 100%; height: 400px;"></div>
                            </div>
                        </div>

                        <!-- 2.2.2 Top Descriptor Frequency Charts -->
                        <div class="mb-12">
                            <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Top Descriptor Frequencies by Verdict</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- AI Descriptors -->
                                <div class="bg-white p-6 rounded-lg border border-border shadow-sm">
                                    <div class="border-l-4 border-ai pl-3 mb-4">
                                        <h3 class="text-xs font-bold text-ai uppercase">AI Verdict - Top 15 Descriptors</h3>
                                    </div>
                                    <div id="chart-ai-descriptors" style="width: 100%; height: 450px;"></div>
                                </div>

                                <!-- Real Descriptors -->
                                <div class="bg-white p-6 rounded-lg border border-border shadow-sm">
                                    <div class="border-l-4 border-human pl-3 mb-4">
                                        <h3 class="text-xs font-bold text-human uppercase">Real Verdict - Top 15 Descriptors</h3>
                                    </div>
                                    <div id="chart-real-descriptors" style="width: 100%; height: 450px;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 2.2.3 Entity ‚Üí Descriptor Flow Analysis - Separate for AI and Real -->
                        <div class="mb-12">
                            <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Entity ‚Üí Descriptor Flow Analysis</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- AI Flow -->
                                <div class="bg-white p-6 rounded-lg border border-border shadow-sm">
                                    <div class="border-l-4 border-ai pl-3 mb-4">
                                        <h3 class="text-xs font-bold text-ai uppercase">AI Verdict Flow</h3>
                                    </div>
                                    <div id="chart-sankey-ai" style="width: 100%; height: 350px;"></div>
                                </div>

                                <!-- Real Flow -->
                                <div class="bg-white p-6 rounded-lg border border-border shadow-sm">
                                    <div class="border-l-4 border-human pl-3 mb-4">
                                        <h3 class="text-xs font-bold text-human uppercase">Real Verdict Flow</h3>
                                    </div>
                                    <div id="chart-sankey-real" style="width: 100%; height: 350px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="bg-human/5 border border-human/20 p-4 rounded-lg text-sm text-gray-700 leading-relaxed">
                        <strong>Key Findings:</strong>
                        <ul class="mt-2 space-y-1 ml-4 list-disc" id="key-findings-list"></ul>
                    </div>
                </section>

            </div>
        </div>

        <!-- ===== VIEW 2: GAME PREVIEW ===== -->
        <div id="view-game" class="absolute inset-0 grid grid-cols-1 lg:grid-cols-[1fr_420px] gap-6 p-4 lg:p-6 hidden">
            <!-- LEFT: IMAGE PANEL -->
            <section class="relative bg-white border border-border shadow-sm rounded-lg overflow-hidden flex items-center justify-center group select-none">
                <!-- Source Badge -->
                <div id="source-badge" class="absolute top-4 right-4 z-20">
                    <div class="flex items-center gap-2 bg-black/80 backdrop-blur-md text-white text-xs font-medium px-3 py-1.5 rounded-full shadow-lg">
                        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701z"/></svg>
                        <span>From r/RealOrAI</span>
                    </div>
                </div>

                <!-- Image -->
                <img id="main-image" src="" alt="Target" class="w-full h-full object-contain target-image" />

                <!-- Result Overlay (Donut) -->
                <div id="result-overlay" class="absolute inset-0 z-10 hidden flex-col items-center justify-center pointer-events-none">
                    <div class="donut-wrapper bg-white/95 backdrop-blur-sm p-8 rounded-2xl shadow-2xl flex flex-col items-center text-center max-w-xs border border-white/50">
                        <div class="relative w-32 h-32 rounded-full mb-4" id="donut-chart">
                            <div class="absolute inset-4 bg-white rounded-full flex items-center justify-center shadow-inner">
                                <span id="donut-text" class="text-2xl font-bold text-text">AI</span>
                            </div>
                        </div>
                        <h3 id="overlay-title" class="text-lg font-bold text-text mb-1">AI Generated</h3>
                        <p id="overlay-subtitle" class="text-xs text-secondary font-medium uppercase tracking-wide">Community Verdict</p>
                        <div class="mt-4 text-xs text-secondary bg-gray-100 px-3 py-1.5 rounded-full" id="agreement-text">
                            You agreed with 85%
                        </div>
                    </div>
                </div>
            </section>

            <!-- RIGHT: INTERACTION PANEL -->
            <section class="flex flex-col bg-white border border-border shadow-sm rounded-lg overflow-hidden h-full">
                <div class="px-6 py-4 border-b border-border bg-gray-50/50 flex items-center justify-between shrink-0">
                    <div class="flex items-center gap-2">
                        <span class="bg-primary text-white text-[9px] px-1.5 py-0.5 rounded-sm">MOD_01</span>
                        <h2 class="text-xs font-bold text-gray-500 uppercase tracking-wider">Classification Protocol</h2>
                    </div>
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                </div>

                <div id="interaction-content" class="flex-1 overflow-y-auto no-scrollbar p-6 relative"></div>

                <div id="bottom-nav" class="hidden p-4 border-t border-border bg-gray-50 gap-3 shrink-0 panel-fade-in">
                    <button onclick="switchView('analysis')" class="flex-1 py-3 px-4 bg-white border border-gray-300 rounded-md text-sm font-semibold text-gray-600 hover:bg-gray-50 transition-colors">Back to Analysis</button>
                    <button onclick="nextImage()" class="flex-1 py-3 px-4 bg-primary text-white rounded-md text-sm font-semibold hover:bg-primary-dark transition-colors shadow-sm flex items-center justify-center gap-2">Next Image ‚Üí</button>
                </div>
            </section>
        </div>

    </main>

    <script>
        // Initialize data
        const config = VISUALIZATION_CONFIG;

        // ===== DATA POPULATION FUNCTIONS =====

        function populateDescriptiveStatsTables() {
            // Basic Stats
            const basicTbody = document.getElementById('basic-stats-tbody');
            basicTbody.innerHTML = `
                <tr><td class="font-semibold">Total Posts</td><td class="font-bold text-primary">${config.overallStats.totalPosts.toLocaleString()}</td></tr>
                <tr><td class="font-semibold">Time Period</td><td>${config.overallStats.timePeriod}</td></tr>
                <tr><td class="font-semibold">Unique Authors</td><td>${config.overallStats.uniqueAuthors}</td></tr>
                <tr><td class="font-semibold">Total Comments</td><td>${config.overallStats.totalComments.toLocaleString()}</td></tr>
                <tr><td class="font-semibold">Hot Posts (Top 10%)</td><td>${config.overallStats.hotPostsCount} <span class="text-xs text-gray-500">(score ‚â• ${config.overallStats.hotPostsThreshold})</span></td></tr>
            `;

            // Verdict Distribution
            const verdictTbody = document.getElementById('verdict-stats-tbody');
            const totalPosts = config.overallStats.totalPosts;
            verdictTbody.innerHTML = `
                <tr class="bg-red-50/50">
                    <td class="font-semibold"><span class="inline-block w-3 h-3 rounded-full bg-ai mr-2"></span>AI</td>
                    <td class="font-bold">${config.overallStats.verdictDistribution.AI}</td>
                    <td class="font-mono text-ai">${(config.overallStats.verdictDistribution.AI/totalPosts*100).toFixed(1)}%</td>
                </tr>
                <tr class="bg-blue-50/50">
                    <td class="font-semibold"><span class="inline-block w-3 h-3 rounded-full bg-human mr-2"></span>Real</td>
                    <td class="font-bold">${config.overallStats.verdictDistribution.Real}</td>
                    <td class="font-mono text-human">${(config.overallStats.verdictDistribution.Real/totalPosts*100).toFixed(1)}%</td>
                </tr>
                <tr class="bg-yellow-50/50">
                    <td class="font-semibold"><span class="inline-block w-3 h-3 rounded-full bg-unsure mr-2"></span>Unsure</td>
                    <td class="font-bold">${config.overallStats.verdictDistribution.Unsure}</td>
                    <td class="font-mono text-unsure">${(config.overallStats.verdictDistribution.Unsure/totalPosts*100).toFixed(1)}%</td>
                </tr>
            `;

        }

        function loadSimulationExample() {
            const example = config.galleryImages[2]; // Using 1nrcy7c (Portrait with ear anomaly)
            const imgPath = `static/images/${example.filename}`;

            document.getElementById('sim-image').src = imgPath;
            document.getElementById('sim-title').textContent = `[HELP] ${example.title} - Is this AI?`;

            // Create annotations
            const annotations = document.getElementById('sim-annotations');
            example.visualAnnotations.annotations.forEach((anno, idx) => {
                const color = anno.verdict === 'AI' ? 'red' : 'green';
                annotations.innerHTML += `
                    <div id="anno-${idx}" class="annotation-box border-${color}-500"
                         style="top: ${anno.position.top}; left: ${anno.position.left};
                                width: ${anno.size.width}; height: ${anno.size.height};">
                        <span class="absolute -top-6 left-1/2 -translate-x-1/2 bg-${color}-500 text-white text-[10px] px-2 py-0.5 rounded whitespace-nowrap">
                            ${anno.entity} (${anno.descriptor})
                        </span>
                    </div>
                `;
            });

            // Create comment stream
            const stream = document.getElementById('comment-stream');
            stream.innerHTML = example.topRationales.slice(0, 2).map((rat, idx) => {
                const verdictClass = rat.verdict === 'AI' ? 'ai bg-red-50 border-red-100' : 'human bg-blue-50 border-blue-100';
                return `
                    <div class="comment-item p-3 rounded border border-transparent hover:border-gray-200"
                         onmouseover="highlight('anno-${idx}')" onmouseout="unhighlight('anno-${idx}')">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-gray-600">u/${rat.user}</span>
                            <span class="text-[10px] text-${verdictClass} px-1.5 py-0.5 rounded font-bold border">FOR ${rat.verdict.toUpperCase()}</span>
                        </div>
                        <p class="text-sm text-gray-700">${rat.text}</p>
                    </div>
                `;
            }).join('');

            // Start animation
            animateComments();
        }

        function animateComments() {
            const comments = document.querySelectorAll('.comment-item');
            let idx = 0;
            setInterval(() => {
                comments.forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.annotation-box').forEach(a => a.classList.remove('active'));
                if (comments[idx]) {
                    comments[idx].classList.add('active');
                    document.getElementById(`anno-${idx}`)?.classList.add('active');
                }
                idx = (idx + 1) % (comments.length + 1);
            }, 3000);
        }

        function highlight(id) { document.getElementById(id)?.classList.add('active'); }
        function unhighlight(id) { document.getElementById(id)?.classList.remove('active'); }

        function populateGallery() {
            const container = document.getElementById('gallery-container');
            container.innerHTML = config.galleryImages.map(img => {
                const verdictColor = img.botVerdict === 'AI' ? 'ai' : (img.botVerdict === 'Real' ? 'human' : 'unsure');
                const imgPath = `static/images/${img.filename}`;

                return `
                    <div class="min-w-[200px] h-[300px] relative rounded-lg overflow-hidden group snap-center border border-border shadow-sm">
                        <img src="${imgPath}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/200x300?text=Image+Not+Found'">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-100"></div>
                        <div class="absolute bottom-3 left-3 right-3 text-white">
                            <div class="flex gap-1 mb-2 flex-wrap">
                                ${img.tags.slice(0, 2).map(tag => `
                                    <span class="text-[10px] bg-white/20 px-1.5 py-0.5 rounded backdrop-blur-sm">#${tag}</span>
                                `).join('')}
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-2 h-2 rounded-full bg-${verdictColor} mr-1"></span>
                                <span class="text-xs font-bold">${img.botVerdict} Verdict</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateStrategyCards() {
            const container = document.getElementById('strategy-cards');
            container.innerHTML = config.strategies.map(strategy => `
                <div class="strategy-card bg-white p-4 rounded border border-border hover:border-primary group">
                    <div class="w-10 h-10 rounded flex items-center justify-center mb-3 text-2xl"
                         style="background-color: ${strategy.color}20; color: ${strategy.color}">
                        ${strategy.icon}
                    </div>
                    <div class="font-bold text-[11px] uppercase text-gray-700 mb-2">${strategy.name}</div>
                    <div class="text-[10px] text-gray-500 leading-tight mb-3">${strategy.description}</div>
                    <div class="text-[9px] text-gray-400 space-y-1">
                        <div class="font-semibold">Examples:</div>
                        ${strategy.examples.slice(0, 1).map(ex => `<div class="italic">"${ex}"</div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function populateSummaries() {
            document.getElementById('overall-summary').textContent = config.summaryConclusions.overall;

            const findingsList = document.getElementById('key-findings-list');
            findingsList.innerHTML = config.summaryConclusions.keyFindings.map(finding =>
                `<li>${finding}</li>`
            ).join('');
        }

        // ===== CHART INITIALIZATION =====

        function initCharts() {

            // Hot Entities Word Cloud - Combined entities, scenes, and styles
            const chartWordCloud = echarts.init(document.getElementById('chart-wordcloud'));

            // Combine all data: entities, scenes, and styles
            const wordCloudData = [
                ...config.hotEntities.map(e => ({ name: e.name, value: e.value, type: 'entity' })),
                ...config.imageKeywords.scenes.map(s => ({ name: s.name, value: s.count, type: 'scene' })),
                ...config.imageKeywords.styles.map(s => ({ name: s.name, value: s.count, type: 'style' }))
            ];

            chartWordCloud.setOption({
                series: [{
                    type: 'wordCloud',
                    shape: 'circle',
                    left: 'center',
                    top: 'center',
                    width: '100%',
                    height: '100%',
                    right: null,
                    bottom: null,
                    sizeRange: [16, 60],
                    rotationRange: [-45, 45],
                    rotationStep: 45,
                    gridSize: 8,
                    drawOutOfBound: false,
                    layoutAnimation: true,
                    textStyle: {
                        fontFamily: 'Inter, sans-serif',
                        fontWeight: 'bold',
                        color: function(params) {
                            const item = wordCloudData.find(d => d.name === params.name);
                            if (item.type === 'entity') return '#D9534F';  // Red for entities
                            if (item.type === 'scene') return '#5BC0DE';   // Blue for scenes
                            if (item.type === 'style') return '#10b981';   // Green for styles
                            return '#6b7280';
                        }
                    },
                    emphasis: {
                        focus: 'self',
                        textStyle: {
                            textShadowBlur: 10,
                            textShadowColor: '#333'
                        }
                    },
                    data: wordCloudData.map(d => ({ name: d.name, value: d.value }))
                }]
            });

            // Radar Chart
            const chartRadar = echarts.init(document.getElementById('chart-radar'));

            // Map the strategy values in the correct order based on the strategies array
            const aiRadarValues = config.strategies.map(strategy =>
                config.strategyDistribution.AI[strategy.name] || 0
            );
            const realRadarValues = config.strategies.map(strategy =>
                config.strategyDistribution.Real[strategy.name] || 0
            );

            chartRadar.setOption({
                tooltip: {},
                legend: {
                    data: ['AI Verdict', 'Real Verdict'],
                    bottom: 10
                },
                radar: {
                    indicator: config.strategies.map(s => ({
                        name: s.name,
                        max: 30
                    })),
                    splitArea: { show: true, areaStyle: { color: ['rgba(255,255,255,0.1)', 'rgba(0,0,0,0.02)'] } },
                    axisLine: { lineStyle: { color: '#999' } }
                },
                series: [{
                    type: 'radar',
                    data: [
                        {
                            value: aiRadarValues,
                            name: 'AI Verdict',
                            itemStyle: { color: '#D9534F' },
                            areaStyle: { opacity: 0.2 }
                        },
                        {
                            value: realRadarValues,
                            name: 'Real Verdict',
                            itemStyle: { color: '#5BC0DE' },
                            areaStyle: { opacity: 0.2 }
                        }
                    ]
                }]
            });

            // AI Descriptors Bar Chart
            const chartAIDescriptors = echarts.init(document.getElementById('chart-ai-descriptors'));
            const aiDescriptors = config.entityDescriptorData.AI.topDescriptors.slice(0, 15);
            chartAIDescriptors.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    formatter: (params) => `${params[0].name}: ${params[0].value} occurrences`
                },
                grid: { left: '25%', right: '8%', bottom: '5%', top: '3%' },
                xAxis: {
                    type: 'value',
                    name: 'Frequency',
                    nameLocation: 'middle',
                    nameGap: 25
                },
                yAxis: {
                    type: 'category',
                    data: aiDescriptors.map(d => d.descriptor).reverse(),
                    axisLabel: { fontSize: 11 }
                },
                series: [{
                    type: 'bar',
                    data: aiDescriptors.map(d => d.count).reverse(),
                    itemStyle: {
                        color: '#D9534F',
                        borderRadius: [0, 4, 4, 0]
                    },
                    label: {
                        show: true,
                        position: 'right',
                        fontSize: 10,
                        color: '#666'
                    }
                }]
            });

            // Real Descriptors Bar Chart
            const chartRealDescriptors = echarts.init(document.getElementById('chart-real-descriptors'));
            const realDescriptors = config.entityDescriptorData.Real.topDescriptors.slice(0, 15);
            chartRealDescriptors.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' },
                    formatter: (params) => `${params[0].name}: ${params[0].value} occurrences`
                },
                grid: { left: '25%', right: '8%', bottom: '5%', top: '3%' },
                xAxis: {
                    type: 'value',
                    name: 'Frequency',
                    nameLocation: 'middle',
                    nameGap: 25
                },
                yAxis: {
                    type: 'category',
                    data: realDescriptors.map(d => d.descriptor).reverse(),
                    axisLabel: { fontSize: 11 }
                },
                series: [{
                    type: 'bar',
                    data: realDescriptors.map(d => d.count).reverse(),
                    itemStyle: {
                        color: '#5BC0DE',
                        borderRadius: [0, 4, 4, 0]
                    },
                    label: {
                        show: true,
                        position: 'right',
                        fontSize: 10,
                        color: '#666'
                    }
                }]
            });


            // Sankey Charts - Separate for AI and Real
            const chartSankeyAI = echarts.init(document.getElementById('chart-sankey-ai'));
            const chartSankeyReal = echarts.init(document.getElementById('chart-sankey-real'));

            // Prepare AI sankey data
            const aiNodes = [];
            const aiLinks = [];
            config.entityDescriptorData.AI.topEntities.slice(0, 5).forEach(entity => {
                aiNodes.push({ name: entity.entity });
                entity.descriptors.slice(0, 2).forEach(desc => {
                    if (!aiNodes.find(n => n.name === desc)) {
                        aiNodes.push({ name: desc });
                    }
                    aiLinks.push({
                        source: entity.entity,
                        target: desc,
                        value: Math.floor(entity.count / entity.descriptors.length)
                    });
                });
            });

            chartSankeyAI.setOption({
                tooltip: { trigger: 'item' },
                series: {
                    type: 'sankey',
                    layout: 'none',
                    emphasis: { focus: 'adjacency' },
                    data: aiNodes,
                    links: aiLinks,
                    lineStyle: { color: 'source', curveness: 0.5 },
                    itemStyle: { color: '#D9534F', borderColor: '#D9534F' },
                    label: { fontSize: 10 }
                }
            });

            // Prepare Real sankey data
            const realNodes = [];
            const realLinks = [];
            config.entityDescriptorData.Real.topEntities.slice(0, 5).forEach(entity => {
                realNodes.push({ name: entity.entity });
                entity.descriptors.slice(0, 2).forEach(desc => {
                    if (!realNodes.find(n => n.name === desc)) {
                        realNodes.push({ name: desc });
                    }
                    realLinks.push({
                        source: entity.entity,
                        target: desc,
                        value: Math.floor(entity.count / entity.descriptors.length)
                    });
                });
            });

            chartSankeyReal.setOption({
                tooltip: { trigger: 'item' },
                series: {
                    type: 'sankey',
                    layout: 'none',
                    emphasis: { focus: 'adjacency' },
                    data: realNodes,
                    links: realLinks,
                    lineStyle: { color: 'source', curveness: 0.5 },
                    itemStyle: { color: '#5BC0DE', borderColor: '#5BC0DE' },
                    label: { fontSize: 10 }
                }
            });

            // Resize handler
            window.addEventListener('resize', () => {
                chartWordCloud.resize();
                chartRadar.resize();
                chartAIDescriptors.resize();
                chartRealDescriptors.resize();
                chartSankeyAI.resize();
                chartSankeyReal.resize();
            });
        }

        // ===== GAME FUNCTIONS =====

        let currentGameImageIndex = 0;

        function initGame() {
            loadGameImage(0);
        }

        function loadGameImage(index) {
            currentGameImageIndex = index;
            const example = config.galleryImages[index];
            const imgPath = `data/gallery/${example.filename}`;

            document.getElementById('main-image').src = imgPath;
            document.getElementById('main-image').classList.remove('blur-state');
            document.getElementById('result-overlay').classList.add('hidden');
            document.getElementById('result-overlay').classList.remove('show-overlay');
            document.getElementById('bottom-nav').classList.add('hidden');

            renderGuessingState();
        }

        function renderGuessingState() {
            document.getElementById('interaction-content').innerHTML = `
                <div class="flex flex-col h-full justify-center panel-fade-in">
                    <div class="mb-8 text-center">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">üßê</div>
                        <h3 class="text-lg font-bold text-gray-800 mb-2">Analyze this Image</h3>
                        <p class="text-sm text-gray-500 max-w-xs mx-auto">Look closely at textures, lighting, and anatomical details. What is your verdict?</p>
                    </div>
                    <div class="space-y-3">
                        <button onclick="submitGuess('ai')" class="w-full group relative flex items-center justify-between p-4 bg-white border-2 border-gray-100 hover:border-ai hover:bg-red-50/30 rounded-lg transition-all duration-200">
                            <span class="font-bold text-gray-700 group-hover:text-ai">It's AI Generated</span>
                            <span class="text-xl grayscale group-hover:grayscale-0 transition-all">ü§ñ</span>
                        </button>
                        <button onclick="submitGuess('human')" class="w-full group relative flex items-center justify-between p-4 bg-white border-2 border-gray-100 hover:border-human hover:bg-blue-50/30 rounded-lg transition-all duration-200">
                            <span class="font-bold text-gray-700 group-hover:text-human">It's Real Photo</span>
                            <span class="text-xl grayscale group-hover:grayscale-0 transition-all">üì∑</span>
                        </button>
                        <button onclick="submitGuess('unsure')" class="w-full group relative flex items-center justify-between p-4 bg-white border-2 border-gray-100 hover:border-unsure hover:bg-yellow-50/30 rounded-lg transition-all duration-200">
                            <span class="font-bold text-gray-700 group-hover:text-unsure">I'm Unsure</span>
                            <span class="text-xl grayscale group-hover:grayscale-0 transition-all">ü§î</span>
                        </button>
                    </div>
                </div>`;
        }

        function submitGuess(guess) {
            const example = config.galleryImages[currentGameImageIndex];
            document.getElementById('main-image').classList.add('blur-state');

            const overlay = document.getElementById('result-overlay');
            overlay.classList.remove('hidden');
            setTimeout(() => overlay.classList.add('show-overlay'), 10);

            const verdict = example.communityVerdict;
            const total = verdict.AI + verdict.Real + verdict.Unsure;
            const aiPct = Math.round((verdict.AI / total) * 100);

            document.getElementById('donut-chart').style.background =
                `conic-gradient(#D9534F 0% ${aiPct}%, #5BC0DE ${aiPct}% ${aiPct + Math.round((verdict.Real / total) * 100)}%, #F0AD4E ${aiPct + Math.round((verdict.Real / total) * 100)}% 100%)`;

            const donutText = document.getElementById('donut-text');
            const title = document.getElementById('overlay-title');

            if (example.botVerdict === 'AI') {
                donutText.textContent = "AI";
                donutText.style.color = "#D9534F";
                title.textContent = "Result: AI Generated";
                title.className = "text-lg font-bold text-ai mb-1";
            } else {
                donutText.textContent = "Real";
                donutText.style.color = "#5BC0DE";
                title.textContent = "Result: Real Photo";
                title.className = "text-lg font-bold text-human mb-1";
            }

            renderResultContent(example, guess);
            document.getElementById('bottom-nav').classList.remove('hidden');
            document.getElementById('bottom-nav').classList.add('flex');
        }

        function renderResultContent(example, userGuess) {
            const container = document.getElementById('interaction-content');
            const correctGuess = userGuess === example.botVerdict.toLowerCase();

            let html = `<div class="panel-fade-in pb-4">`;
            html += `<div class="mb-6 pb-4 border-b border-gray-100">
                        <div class="text-xs font-bold text-gray-400 uppercase mb-1">Final Verdict</div>
                        <div class="text-2xl font-bold text-${example.botVerdict === 'AI' ? 'ai' : 'human'} flex items-center gap-2">
                            ${example.botVerdict === 'AI' ? 'AI Generated ü§ñ' : 'Real Photo üì∑'}
                        </div>
                        <div class="mt-2 text-xs ${correctGuess ? 'text-green-600' : 'text-gray-500'}">
                            ${correctGuess ? '‚úì You guessed correctly!' : '‚úó Your guess was incorrect'}
                        </div>
                     </div>`;

            html += `<div class="space-y-4"><h4 class="font-bold text-sm text-gray-800">Top Community Rationales</h4>`;
            example.topRationales.slice(0, 3).forEach(rat => {
                const borderClass = rat.verdict === 'AI' ? 'border-l-ai' : 'border-l-human';
                const badgeClass = rat.verdict === 'AI' ? 'text-ai bg-red-50' : 'text-human bg-blue-50';
                html += `<div class="pl-3 border-l-4 ${borderClass} py-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold text-gray-500">u/${rat.user}</span>
                                <span class="text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${badgeClass}">${rat.verdict}</span>
                            </div>
                            <p class="text-sm text-gray-700 leading-relaxed">${rat.text}</p>
                         </div>`;
            });
            html += `</div></div>`;

            container.innerHTML = html;
        }

        function nextImage() {
            currentGameImageIndex = (currentGameImageIndex + 1) % config.galleryImages.length;
            loadGameImage(currentGameImageIndex);
        }

        // ===== VIEW SWITCHING =====

        function switchView(viewName) {
            // Update Nav State
            document.getElementById('btn-nav-analysis').className = viewName === 'analysis'
                ? 'px-4 py-1.5 text-xs font-semibold text-white bg-primary rounded shadow-sm transition-colors'
                : 'px-4 py-1.5 text-xs font-semibold text-secondary hover:text-primary transition-colors hover:bg-white rounded';
            document.getElementById('btn-nav-game').className = viewName === 'game'
                ? 'px-4 py-1.5 text-xs font-semibold text-white bg-primary rounded shadow-sm transition-colors'
                : 'px-4 py-1.5 text-xs font-semibold text-secondary hover:text-primary transition-colors hover:bg-white rounded';

            // Toggle Views
            document.getElementById('view-analysis').classList.toggle('hidden', viewName !== 'analysis');
            document.getElementById('view-game').classList.toggle('hidden', viewName !== 'game');

            if (viewName === 'game') {
                initGame();
            }
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            populateDescriptiveStatsTables();
            loadSimulationExample();
            populateGallery();
            populateStrategyCards();
            populateSummaries();
            initCharts();
        });
    </script>
</body>
</html>
